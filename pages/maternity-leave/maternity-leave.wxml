<!--maternity-leave.wxml-->
<navigation-bar title="äº§å‡è®¡ç®—" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <view class="form-section">
      <view class="form-title">åŸºæœ¬ä¿¡æ¯</view>

      <view class="form-item">
        <text class="field-icon">ğŸ™ï¸</text>
        <text class="label">åŸå¸‚</text>
        <picker 
          mode="selector" 
          range="{{cityNames}}" 
          value="{{cityIndex}}" 
          bindchange="onCityChange"
          disabled="{{loadingCities}}"
        >
          <view class="picker">
            {{loadingCities ? 'åŠ è½½ä¸­...' : (cityName || 'è¯·é€‰æ‹©åŸå¸‚')}}
          </view>
        </picker>
      </view>

      <view class="form-item">
        <text class="field-icon">ğŸ“…</text>
        <text class="label">äº§å‡å¼€å§‹æ—¶é—´</text>
        <picker mode="date" value="{{maternityStartDate}}" bindchange="onMaternityStartDateChange">
          <view class="picker">
            {{maternityStartDate || 'è¯·é€‰æ‹©äº§å‡å¼€å§‹æ—¶é—´'}}
          </view>
        </picker>
      </view>
    </view>

    <view class="form-section">
      <view class="form-title">ç”Ÿè‚²æ–¹å¼</view>

      <radio-group bindchange="onDeliveryTypeChange">
        <label class="radio-item">
          <radio value="normal" checked="{{deliveryType === 'normal'}}" />
          <text class="radio-label">é¡ºäº§</text>
        </label>
        <label class="radio-item">
          <radio value="difficult" checked="{{deliveryType === 'difficult'}}" />
          <text class="radio-label">éš¾äº§</text>
        </label>
        <label class="radio-item">
          <radio value="miscarriage" checked="{{deliveryType === 'miscarriage'}}" />
          <text class="radio-label">æµäº§</text>
        </label>
      </radio-group>

      <view class="form-item" wx:if="{{deliveryType === 'miscarriage'}}">
        <text class="field-icon">ğŸ“‹</text>
        <text class="label">æµäº§è§„åˆ™</text>
        <picker 
          mode="selector" 
          range="{{miscarriageRuleDescriptions}}" 
          value="{{miscarriageRuleIndex}}" 
          bindchange="onMiscarriageRuleChange"
          disabled="{{loadingMiscarriageRules}}"
        >
          <view class="picker">
            {{loadingMiscarriageRules ? 'åŠ è½½ä¸­...' : (miscarriageRuleDescriptions[miscarriageRuleIndex] || 'è¯·é€‰æ‹©æµäº§è§„åˆ™')}}
          </view>
        </picker>
      </view>

      <view class="form-item" wx:if="{{deliveryType !== 'miscarriage'}}">
        <text class="field-icon">ğŸ‘¶</text>
        <text class="label">å©´å„¿æ•°é‡</text>
        <picker 
          mode="selector" 
          range="{{multipleOptions}}" 
          value="{{multipleIndex}}" 
          bindchange="onMultipleChange"
        >
          <view class="picker">
            {{multipleOptions[multipleIndex]}}
          </view>
        </picker>
      </view>
    </view>

    <view class="form-section">
      <view class="form-title">å…¶ä»–å‡æœŸ</view>

      <view class="form-item-switch">
        <text class="label">æ˜¯å¦æœ‰æ™šè‚²å‡/ç”Ÿè‚²å‡/å¥–åŠ±å‡</text>
        <switch checked="{{hasExtendedDays}}" bindchange="onHasExtendedDaysChange" />
      </view>
    </view>

    <view class="form-section" wx:if="{{cityCode === 'CD'}}">
      <view class="form-title">æˆéƒ½ç‰¹æ®Šé€‰é¡¹</view>
      
      <view class="form-item-switch">
        <text class="label">æ˜¯å¦æ¯ä¹³å–‚å…»ï¼ˆé¢å¤–ä¸€ä¸ªæœˆï¼‰</text>
        <switch checked="{{isBreastFeeding}}" bindchange="onIsBreastFeedingChange" />
      </view>
    </view>

    <view class="form-section" wx:if="{{cityCode === 'SX'}}">
      <view class="form-title">ç»å…´ç‰¹æ®Šé€‰é¡¹</view>
      
      <view class="form-item-switch">
        <text class="label">æ˜¯å¦ç”Ÿè‚²ä¸€å­©</text>
        <switch checked="{{isFirstTimeBirth}}" bindchange="onIsFirstTimeBirthChange" />
      </view>
    </view>

    <view class="form-section" wx:if="{{cityCode === 'GZ' && isDifficultBirth}}">
      <view class="form-title">å¹¿å·éš¾äº§å‡æœŸ</view>
      
      <view class="form-item">
        <text class="label">éš¾äº§å‡æœŸå¤©æ•°ï¼ˆ15æˆ–30å¤©ï¼‰</text>
        <input 
          class="input" 
          type="number" 
          placeholder="è¯·è¾“å…¥15æˆ–30" 
          value="{{additionalDystociaDays}}"
          bindinput="onAdditionalDystociaDaysInput"
        />
      </view>
    </view>

    <view class="form-section">
      <view class="form-title">å…¶ä»–é€‰é¡¹ï¼ˆå¯é€‰ï¼‰</view>
      
      <view class="form-item">
        <text class="label">åŒ»å˜±å¤©æ•°</text>
        <input 
          class="input" 
          type="number" 
          placeholder="è¯·è¾“å…¥åŒ»å˜±å¤©æ•°" 
          value="{{doctorRecommendDays}}"
          bindinput="onDoctorRecommendDaysInput"
        />
      </view>
    </view>

    <view class="button-group">
      <button class="btn btn-primary" bindtap="calculate">è®¡ç®—äº§å‡</button>
      <button class="btn btn-secondary" bindtap="reset">é‡ç½®</button>
    </view>

    <view class="result-section" wx:if="{{showResult && result}}">
      <view class="result-title">è®¡ç®—ç»“æœ</view>
      
      <view class="result-card">
        <view class="result-main">
          <text class="result-label">æ€»äº§å‡å¤©æ•°</text>
          <text class="result-value">{{result.totalDays}}å¤©</text>
        </view>
        
        <view class="result-detail">
          <view class="detail-item">
            <text class="detail-label">åŸºç¡€äº§å‡</text>
            <text class="detail-value">{{result.baseDays}}å¤©</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">éš¾äº§å‡</text>
            <text class="detail-value">{{result.dystociaDays}}å¤©</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">å¤šèƒèƒå‡</text>
            <text class="detail-value">{{result.multiBabyDays}}å¤©</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ™šè‚²/å¥–åŠ±å‡</text>
            <text class="detail-value">{{result.extendedDays}}å¤©</text>
          </view>
        </view>

        <view class="result-date">
          <view class="date-item">
            <text class="date-label">å¼€å§‹æ—¥æœŸ</text>
            <text class="date-value">{{result.startDate}}</text>
          </view>
          <view class="date-item">
            <text class="date-label">ç»“æŸæ—¥æœŸ</text>
            <text class="date-value">{{result.endDate}}</text>
          </view>
          <view class="date-item">
            <text class="date-label">è¿”å²—æ—¥æœŸ</text>
            <text class="date-value">{{result.returnToWorkDate}}</text>
          </view>
        </view>

        <view class="result-info">
          <view class="info-row">
            <text class="info-label">åŸå¸‚ï¼š</text>
            <text class="info-value">{{result.cityName}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ´¥è´´å¤©æ•°ï¼š</text>
            <text class="info-value">{{result.totalAllowanceDays}}å¤©</text>
          </view>
          <view class="info-row" wx:if="{{result.pubHolidaysCount > 0}}">
            <text class="info-label">èŠ‚å‡æ—¥é¡ºå»¶ï¼š</text>
            <text class="info-value">{{result.pubHolidaysCount}}å¤©</text>
          </view>
        </view>

        <view class="result-timeline" wx:if="{{result.timeScopeList && result.timeScopeList.length > 0}}">
          <text class="timeline-title">å‡æœŸæ—¶é—´æ®µï¼š</text>
          <view class="timeline-list">
            <view class="timeline-item" wx:for="{{result.timeScopeList}}" wx:key="index">
              <text class="timeline-type">{{item.type === 'BASE' ? 'åŸºç¡€äº§å‡' : item.type === 'EXTENDED' ? 'æ™šè‚²/å¥–åŠ±å‡' : item.type === 'DYSTOCIA' ? 'éš¾äº§å‡' : item.type === 'MULTI_BABY' ? 'å¤šèƒèƒå‡' : 'å…¶ä»–'}}</text>
              <text class="timeline-days">{{item.days}}å¤©</text>
              <text class="timeline-date">{{item.startDate}} ~ {{item.endDate}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</scroll-view>
