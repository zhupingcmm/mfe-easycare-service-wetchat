<!--index.wxml-->
<navigation-bar title="ç”Ÿè‚²æœåŠ¡" back="{{false}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <view class="tab-buttons">
      <view 
        class="tab-button {{activeTab === 'maternity' ? 'active' : ''}}"
        bindtap="switchTab"
        data-tab="maternity"
      >
        <text class="tab-icon">ğŸ“…</text>
        <text class="tab-text">äº§å‡è®¡ç®—</text>
      </view>
      <view 
        class="tab-button {{activeTab === 'allowance' ? 'active' : ''}}"
        bindtap="switchTab"
        data-tab="allowance"
      >
        <text class="tab-icon">ğŸ’°</text>
        <text class="tab-text">æ´¥è´´è®¡ç®—</text>
      </view>
    </view>

    <!-- äº§å‡è®¡ç®—è¡¨å• -->
    <view class="content-area" wx:if="{{activeTab === 'maternity'}}">
      <view class="form-section">
        <view class="form-title">åŸºæœ¬ä¿¡æ¯</view>

        <view class="form-item">
          <text class="field-icon">ğŸ™ï¸</text>
          <text class="label"><text class="required">*</text>åŸå¸‚</text>
          <picker 
            mode="selector" 
            range="{{cityNames}}" 
            value="{{cityIndex}}" 
            bindchange="onCityChange"
            disabled="{{loadingCities}}"
          >
            <view class="picker">
              {{loadingCities ? 'åŠ è½½ä¸­...' : (cityName || 'è¯·é€‰æ‹©åŸå¸‚')}}
            </view>
          </picker>
        </view>

        <view class="form-item">
          <text class="field-icon">ğŸ“…</text>
          <text class="label"><text class="required">*</text>äº§å‡å¼€å§‹æ—¶é—´</text>
          <picker mode="date" value="{{maternityStartDate}}" bindchange="onMaternityStartDateChange">
            <view class="picker">
              {{maternityStartDate || 'è¯·é€‰æ‹©äº§å‡å¼€å§‹æ—¶é—´'}}
            </view>
          </picker>
        </view>
      </view>

      <view class="form-section">
        <view class="form-title">ç”Ÿè‚²æ–¹å¼</view>

        <radio-group bindchange="onDeliveryTypeChange">
          <label class="radio-item">
            <radio value="normal" checked="{{deliveryType === 'normal'}}" />
            <text class="radio-label">é¡ºäº§</text>
          </label>
          <label class="radio-item">
            <radio value="difficult" checked="{{deliveryType === 'difficult'}}" />
            <text class="radio-label">éš¾äº§</text>
          </label>
          <label class="radio-item">
            <radio value="miscarriage" checked="{{deliveryType === 'miscarriage'}}" />
            <text class="radio-label">æµäº§</text>
          </label>
        </radio-group>

        <view class="form-item" wx:if="{{deliveryType === 'miscarriage'}}">
          <text class="field-icon">ğŸ“‹</text>
          <text class="label"><text class="required">*</text>æµäº§è§„åˆ™</text>
          <picker 
            mode="selector" 
            range="{{miscarriageRuleDescriptions}}" 
            value="{{miscarriageRuleIndex}}" 
            bindchange="onMiscarriageRuleChange"
            disabled="{{loadingMiscarriageRules}}"
          >
            <view class="picker">
              {{loadingMiscarriageRules ? 'åŠ è½½ä¸­...' : (miscarriageRuleDescriptions[miscarriageRuleIndex] || 'è¯·é€‰æ‹©æµäº§è§„åˆ™')}}
            </view>
          </picker>
        </view>

        <view class="form-item" wx:if="{{deliveryType !== 'miscarriage'}}">
          <text class="field-icon">ğŸ‘¶</text>
          <text class="label">å©´å„¿æ•°é‡</text>
          <picker 
            mode="selector" 
            range="{{multipleOptions}}" 
            value="{{multipleIndex}}" 
            bindchange="onMultipleChange"
          >
            <view class="picker">
              {{multipleOptions[multipleIndex]}}
            </view>
          </picker>
        </view>
      </view>

      <view class="form-section">
        <view class="form-title">å…¶ä»–å‡æœŸ</view>

        <view class="form-item-switch">
          <text class="label">æ˜¯å¦æœ‰æ™šè‚²å‡/ç”Ÿè‚²å‡/å¥–åŠ±å‡</text>
          <switch checked="{{hasExtendedDays}}" bindchange="onHasExtendedDaysChange" />
        </view>
      </view>

      <view class="button-group">
        <button class="btn btn-primary" bindtap="calculateMaternity">è®¡ç®—äº§å‡</button>
        <button class="btn btn-secondary" bindtap="resetMaternity">é‡ç½®</button>
      </view>

      <view class="result-section" wx:if="{{showMaternityResult && maternityResult}}">
        <view class="result-title">è®¡ç®—ç»“æœ</view>
        <view class="result-card">
          <view class="result-item">
            <text class="result-label">æ€»å¤©æ•°</text>
            <text class="result-value">{{maternityResult.totalDays}}å¤©</text>
          </view>
          <view class="result-item">
            <text class="result-label">å¼€å§‹æ—¥æœŸ</text>
            <text class="result-value">{{maternityResult.startDate}}</text>
          </view>
          <view class="result-item">
            <text class="result-label">ç»“æŸæ—¥æœŸ</text>
            <text class="result-value">{{maternityResult.endDate}}</text>
          </view>
          <view class="result-item">
            <text class="result-label">è¿”å²—æ—¥æœŸ</text>
            <text class="result-value">{{maternityResult.returnToWorkDate}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ´¥è´´è®¡ç®—è¡¨å• -->
    <view class="content-area" wx:if="{{activeTab === 'allowance'}}">
      <view class="form-section">
        <view class="form-title">æ´¥è´´ä¿¡æ¯</view>
        
        <view class="form-item">
          <text class="field-icon">ğŸ’°</text>
          <text class="label">æ”¿åºœå‘æ”¾é‡‘é¢ï¼ˆå…ƒï¼‰</text>
          <input 
            class="input" 
            type="digit" 
            placeholder="è¯·è¾“å…¥é‡‘é¢" 
            value="{{govTotalAmount}}"
            bindinput="onGovTotalAmountInput"
          />
        </view>

        <view class="form-item">
          <text class="field-icon">ğŸ’µ</text>
          <text class="label">äº§å‰12ä¸ªæœˆå¹³å‡å·¥èµ„ï¼ˆå…ƒï¼‰</text>
          <input 
            class="input" 
            type="digit" 
            placeholder="è¯·è¾“å…¥å¹³å‡å·¥èµ„" 
            value="{{avgSalaryBefore12Months}}"
            bindinput="onAvgSalaryBefore12MonthsInput"
          />
        </view>

        <view class="form-item">
          <text class="field-icon">ğŸ’³</text>
          <text class="label">å‘˜å·¥åŸºæœ¬å·¥èµ„ï¼ˆå…ƒ/æœˆï¼‰</text>
          <input 
            class="input" 
            type="digit" 
            placeholder="è¯·è¾“å…¥åŸºæœ¬å·¥èµ„" 
            value="{{baseSalary}}"
            bindinput="onBaseSalaryInput"
          />
        </view>
      </view>

      <view class="button-group">
        <button class="btn btn-primary" bindtap="calculateAllowance">è®¡ç®—æ´¥è´´</button>
        <button class="btn btn-secondary" bindtap="resetAllowance">é‡ç½®</button>
      </view>

      <view class="result-section" wx:if="{{showAllowanceResult && allowanceResult}}">
        <view class="result-title">è®¡ç®—ç»“æœ</view>
        <view class="result-card">
          <view class="result-item">
            <text class="result-label">é¢„è®¡æ€»æ´¥è´´</text>
            <text class="result-value highlight">Â¥{{allowanceResult.totalAmount}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</scroll-view>
